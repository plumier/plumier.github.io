(self.webpackChunkplumier_docs=self.webpackChunkplumier_docs||[]).push([[181],{876:function(e,t,i){"use strict";i.d(t,{Zo:function(){return u},kt:function(){return m}});var n=i(2784);function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){r(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function l(e,t){if(null==e)return{};var i,n,r=function(e,t){if(null==e)return{};var i,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}var c=n.createContext({}),p=function(e){var t=n.useContext(c),i=t;return e&&(i="function"==typeof e?e(t):o(o({},t),e)),i},u=function(e){var t=p(e.components);return n.createElement(c.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var i=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(i),m=r,f=d["".concat(c,".").concat(m)]||d[m]||s[m]||a;return i?n.createElement(f,o(o({ref:t},u),{},{components:i})):n.createElement(f,o({ref:t},u))}));function m(e,t){var i=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=i.length,o=new Array(a);o[0]=d;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<a;p++)o[p]=i[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,i)}d.displayName="MDXCreateElement"},6595:function(e,t,i){"use strict";i.r(t),i.d(t,{frontMatter:function(){return o},metadata:function(){return l},toc:function(){return c},default:function(){return u}});var n=i(7560),r=i(8283),a=(i(2784),i(876)),o={id:"facility",title:"Facility"},l={unversionedId:"facility",id:"facility",isDocsHomePage:!1,title:"Facility",description:"Facility is a configuration component used to configure Plumier application to get a new ability. It consist some middlewares in a correct order, some process before the application initialized and some default application configuration.",source:"@site/docs/Facility.md",sourceDirName:".",slug:"/facility",permalink:"/facility",editUrl:"https://github.com/plumier/plumier/edit/master/docs/docusaurus/docs/Facility.md",version:"current",frontMatter:{id:"facility",title:"Facility"},sidebar:"overview",previous:{title:"Middleware",permalink:"/middleware"},next:{title:"Default Environment Variable",permalink:"/default-environment-variable"}},c=[{value:"Signature",id:"signature",children:[]},{value:"Develop Your Own Facility",id:"develop-your-own-facility",children:[]},{value:"Access Koa from Facility",id:"access-koa-from-facility",children:[]}],p={toc:c};function u(e){var t=e.components,i=(0,r.Z)(e,["components"]);return(0,a.kt)("wrapper",(0,n.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Facility is a configuration component used to configure Plumier application to get a new ability. It consist some middlewares in a correct order, some process before the application initialized and some default application configuration. "),(0,a.kt)("p",null,"For example to build an API you will need: a Body parser, CORS, Generic error handler and some configuration etc, all can be bundled into one facility called ",(0,a.kt)("inlineCode",{parentName:"p"},"WebApiFacility"),". "),(0,a.kt)("h2",{id:"signature"},"Signature"),(0,a.kt)("p",null,"Facility is a class that implements ",(0,a.kt)("inlineCode",{parentName:"p"},"Facility"),", the signature of ",(0,a.kt)("inlineCode",{parentName:"p"},"Facility")," is like below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"export interface Facility {\n    setup(app: Readonly<PlumierApplication>): void\n    generateRoutes(app: Readonly<PlumierApplication>): Promise<RouteMetadata[]>\n    preInitialize(app: Readonly<PlumierApplication>): Promise<void>\n    initialize(app: Readonly<PlumierApplication>, routes:RouteMetadata:[]): Promise<void>\n}\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"setup")," called during setup process. This method usually used for registering configurations and middlewares"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"generateRoutes")," called during initialization process before the ",(0,a.kt)("inlineCode",{parentName:"li"},"initialize")," method. This method provides list of routes produced by Facility. "),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"preInitialize")," called before ",(0,a.kt)("inlineCode",{parentName:"li"},"initialize")," called. This method usually used for some preparation before initialization."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"initialize")," called during initialization process. This method usually used for some preparation required before application run, and possible to call promised functions")),(0,a.kt)("h2",{id:"develop-your-own-facility"},"Develop Your Own Facility"),(0,a.kt)("p",null,"Develop your own Facility is not required, you can register middleware and set some configuration\nmanually. You develop Facility if you want to make it reusable."),(0,a.kt)("p",null,"For example the ",(0,a.kt)("inlineCode",{parentName:"p"},"WebApiFacility")," facility is like below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},'import Cors from "@koa/cors"\nimport BodyParser from "koa-bodyparser"\nimport { DefaultFacility, PlumierApplication } from "plumier"\n\nexport class WebApiFacility extends DefaultFacility {\n    setup(app: Readonly<PlumierApplication>) {\n        app.use({execute: async next => {\n            try{\n                return next.proceed()\n            }\n            catch(e){\n                //do something with the error\n            }\n        }})\n        app.use(BodyParser({ /* configuration */ }))\n        app.use(Cors({ /* configuration */ }))\n    }\n}\n')),(0,a.kt)("p",null,"Above code showing that we setup error handler, body parser and cors with some order.\nError handler in the top most, it means it will handle all error caused by the next middleware / action."),(0,a.kt)("h2",{id:"access-koa-from-facility"},"Access Koa from Facility"),(0,a.kt)("p",null,"In some case if you want to configure Koa, you can do it in facility."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},'import { DefaultFacility, PlumierApplication } from "plumier"\n\nexport class WebApiFacility extends DefaultFacility {\n    setup({ koa }: Readonly<PlumierApplication>) {\n        //do something with the Koa instance\n        koa.use(KOA_MIDDLEWARE)\n    }\n}\n')))}u.isMDXComponent=!0}}]);