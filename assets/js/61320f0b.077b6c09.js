(self.webpackChunkplumier_docs=self.webpackChunkplumier_docs||[]).push([[398],{876:function(e,t,n){"use strict";n.d(t,{Zo:function(){return s},kt:function(){return d}});var r=n(2784);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=r.createContext({}),c=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},s=function(e){var t=c(e.components);return r.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,p=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),m=c(n),d=i,f=m["".concat(p,".").concat(d)]||m[d]||u[d]||a;return n?r.createElement(f,l(l({ref:t},s),{},{components:n})):r.createElement(f,l({ref:t},s))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,l=new Array(a);l[0]=m;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:i,l[1]=o;for(var c=2;c<a;c++)l[c]=n[c];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},8390:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return o},metadata:function(){return p},toc:function(){return c},default:function(){return u}});var r=n(7560),i=n(8283),a=(n(2784),n(876)),l=["components"],o={id:"serve-static",title:"Serve Static Files"},p={unversionedId:"serve-static",id:"serve-static",isDocsHomePage:!1,title:"Serve Static Files",description:"Plumier provided functionality to serve static file using koa-send middleware",source:"@site/docs/Serve-Static.md",sourceDirName:".",slug:"/serve-static",permalink:"/serve-static",editUrl:"https://github.com/plumier/plumier/edit/master/docs/docusaurus/docs/Serve-Static.md",version:"current",frontMatter:{id:"serve-static",title:"Serve Static Files"},sidebar:"overview",previous:{title:"Social Media Login",permalink:"/social-login"},next:{title:"File Upload",permalink:"/file-upload"}},c=[{value:"Enable Functionality",id:"enable-functionality",children:[]},{value:"Serve Single File From Controller",id:"serve-single-file-from-controller",children:[]},{value:"History Api Fallback",id:"history-api-fallback",children:[]}],s={toc:c};function u(e){var t=e.components,n=(0,i.Z)(e,l);return(0,a.kt)("wrapper",(0,r.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Plumier provided functionality to serve static file using ",(0,a.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/koa-send"},"koa-send")," middleware"),(0,a.kt)("h2",{id:"enable-functionality"},"Enable Functionality"),(0,a.kt)("p",null,"Serve static files is optional, you can enable this functionality by install ",(0,a.kt)("inlineCode",{parentName:"p"},"@plumier/serve-static")," and plug ",(0,a.kt)("inlineCode",{parentName:"p"},"ServeStaticFacility")," into Plumier application"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},'import Plumier from "plumier"\nimport { join } from "path"\nimport { ServeStaticFacility } from "@plumier/serve-static"\n\nconst app = new Plumier()\napp.set(new ServeStaticFacility({ root: join(__dirname, "./assets") }))\n')),(0,a.kt)("p",null,"If no ",(0,a.kt)("inlineCode",{parentName:"p"},"root")," directory provided it will automatically search for directory named ",(0,a.kt)("inlineCode",{parentName:"p"},"www")," in the same level with the application. "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},'const app = new Plumier()\n//looks for directory named www\napp.set(new ServeStaticFacility())\n//specify relative directory in the same level \napp.set(new ServeStaticFacility({ root: "assets" }))\n')),(0,a.kt)("p",null,"You can serve multiple folder by specifying multiple facility"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},'const app = new Plumier()\napp.set(new ServeStaticFacility({ root: join(__dirname, "./assets") }))\napp.set(new ServeStaticFacility({ root: join(__dirname, "./images") }))\n')),(0,a.kt)("h2",{id:"serve-single-file-from-controller"},"Serve Single File From Controller"),(0,a.kt)("p",null,"Its possible to serve single file from controller by using ",(0,a.kt)("inlineCode",{parentName:"p"},"FileActionResult")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"response.file()")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},'const HomeController {\n    @route.get()\n    index(){\n        return response.file(join(__dirname, "index.html"))\n        //or use FileActionResult\n        //return new FileActionResult(join(__dirname, "index.html"))\n    }\n}\n')),(0,a.kt)("h2",{id:"history-api-fallback"},"History Api Fallback"),(0,a.kt)("p",null,"History Api Fallback help SPA application which commonly handle navigation using History Api. Its become problem when user hitting refresh button in the middle of navigation or if user bookmark the page because it will result in 404. "),(0,a.kt)("p",null,"Plumier provide ",(0,a.kt)("inlineCode",{parentName:"p"},"@route.historyApiFallback()")," decorator to automatically redirect all the browser request (API or file request can be detected) into the specific controller action. Internally it detects the request ",(0,a.kt)("inlineCode",{parentName:"p"},"Accept")," header to guess if the request comes from a browser or an API call."),(0,a.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"Keep in mind that ",(0,a.kt)("inlineCode",{parentName:"p"},"@route.historyApiFallback()")," require the ",(0,a.kt)("inlineCode",{parentName:"p"},"ServeStaticFacility")," enabled on the Plumier application."))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},'const HomeController {\n    @route.get("/")\n    @route.historyApiFallback()\n    index(){\n        return response.file(join(__dirname, "../../build/index.html"))\n    }\n}\n')),(0,a.kt)("p",null,"Example above showing that you host the SPA html built by ",(0,a.kt)("inlineCode",{parentName:"p"},"create-react-app")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"@vue/cli")," as the root url ",(0,a.kt)("inlineCode",{parentName:"p"},"/"),". The ",(0,a.kt)("inlineCode",{parentName:"p"},"@route.historyApiFallback()")," will automatically redirect all browser request into the root url ",(0,a.kt)("inlineCode",{parentName:"p"},"/")," with exception:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Requested url doesn't have any appropriate controller / handler "),(0,a.kt)("li",{parentName:"ul"},"Requested url is not a static file serve"),(0,a.kt)("li",{parentName:"ul"},"Requested url is not an API call")))}u.isMDXComponent=!0}}]);