(self.webpackChunkplumier_docs=self.webpackChunkplumier_docs||[]).push([[524],{876:function(e,t,n){"use strict";n.d(t,{Zo:function(){return d},kt:function(){return c}});var a=n(2784);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),u=s(n),c=r,k=u["".concat(p,".").concat(c)]||u[c]||m[c]||i;return n?a.createElement(k,l(l({ref:t},d),{},{components:n})):a.createElement(k,l({ref:t},d))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=u;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var s=2;s<i;s++)l[s]=n[s];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},6586:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return o},metadata:function(){return p},toc:function(){return s},default:function(){return m}});var a=n(7560),r=n(8283),i=(n(2784),n(876)),l=["components"],o={id:"controller",title:"Controller"},p={unversionedId:"controller",id:"controller",isDocsHomePage:!1,title:"Controller",description:"Controller is a group of similar functionalities placed in a single class, for example UserController contains functionalities to manage User. Plumier controller is a plain ES6 class contains several methods that will handle http request. Further it provided convention to automatically generate route based on its name, methods name and parameters name.",source:"@site/docs/Controller.md",sourceDirName:".",slug:"/controller",permalink:"/controller",editUrl:"https://github.com/plumier/plumier/edit/master/docs/docusaurus/docs/Controller.md",version:"current",frontMatter:{id:"controller",title:"Controller"},sidebar:"overview",previous:{title:"Entry Point",permalink:"/entry-point"},next:{title:"Security",permalink:"/security"}},s=[{value:"Controller Naming",id:"controller-naming",children:[]},{value:"Registration",id:"registration",children:[]},{value:"Parameter Binding",id:"parameter-binding",children:[]},{value:"Type Converter",id:"type-converter",children:[]},{value:"Controller Return Value",id:"controller-return-value",children:[]},{value:"Action Result",id:"action-result",children:[]},{value:"Throwing Errors",id:"throwing-errors",children:[]}],d={toc:s};function m(e){var t=e.components,n=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Controller is a group of similar functionalities placed in a single class, for example ",(0,i.kt)("inlineCode",{parentName:"p"},"UserController")," contains functionalities to manage User. Plumier controller is a plain ES6 class contains several methods that will handle http request. Further it provided convention to automatically generate route based on its name, methods name and parameters name."),(0,i.kt)("h2",{id:"controller-naming"},"Controller Naming"),(0,i.kt)("p",null,"Plumier doesn't strictly limit the controller name, except it must end with ",(0,i.kt)("inlineCode",{parentName:"p"},"Controller")," word. This is useful when you have non controller class inside ",(0,i.kt)("inlineCode",{parentName:"p"},"controller/")," directory. Controller naming best practice is using plural word, such as ",(0,i.kt)("inlineCode",{parentName:"p"},"AnimalsController"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"UsersController")," "),(0,i.kt)("h2",{id:"registration"},"Registration"),(0,i.kt)("p",null,"By default controller registered automatically by traversed through all files ends with ",(0,i.kt)("inlineCode",{parentName:"p"},"controller")," recursively (",(0,i.kt)("inlineCode",{parentName:"p"},"./**/*controller.+(ts|js)"),"). For example ",(0,i.kt)("inlineCode",{parentName:"p"},"user-controller.ts")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"user_controller.ts"),". "),(0,i.kt)("p",null,"Its also possible to register controller in specific place using ",(0,i.kt)("inlineCode",{parentName:"p"},"ControllerFacility")," using relative/absolute or glob path. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'new Plumier()\n    .set(new WebApiFacility())\n    .set(new ControllerFacility({ controller: "api/*/*-controller.*(ts|js)", rootPath: "api/v1" }))\n    .set(new ControllerFacility({ controller: "controller/*-controller.*(ts|js)" }))\n    .initialize()\n    .then(koa => koa.listen(8000))\n')),(0,i.kt)("p",null,"But keep in mind that when using ",(0,i.kt)("inlineCode",{parentName:"p"},"ControllerFacility")," the default registration behavior is overridden. "),(0,i.kt)("h2",{id:"parameter-binding"},"Parameter Binding"),(0,i.kt)("p",null,"Parameter binding is a Plumier feature to automatically bound request part (context/query/body) into action parameters. Plumier provided 3 kind of parameter binding: Decorator Binding, Name Binding, Model Binding. "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Decorator binding: Bind specific koa context into action parameter by using ",(0,i.kt)("inlineCode",{parentName:"li"},"@bind")," decorator."),(0,i.kt)("li",{parentName:"ul"},"Name binding: Bind query or request body part into action parameter based on parameter name."),(0,i.kt)("li",{parentName:"ul"},"Model binding: Bind request body into parameter which is of type custom class and doesn't match above criteria (decorator binding, name binding)")),(0,i.kt)("h4",{id:"decorator-binding"},"Decorator Binding"),(0,i.kt)("p",null,"Bind action parameter using ",(0,i.kt)("inlineCode",{parentName:"p"},"@bind")," decorator like example below"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"export class AnimalController {\n    @route.post()\n    save(@bind.ctx() ctx:Koa.Context){\n\n    }\n}\n")),(0,i.kt)("p",null,"Some binding decorator accepts string parameter to access its child"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'export class AnimalController {\n    @route.post()\n    save(@bind.ctx("request.body") model:any){\n\n    }\n}\n')),(0,i.kt)("p",null,"Above code is the same as accessing ",(0,i.kt)("inlineCode",{parentName:"p"},"ctx.request.body"),". "),(0,i.kt)("p",null,"Allowed path example: "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Using dot to access child property ",(0,i.kt)("inlineCode",{parentName:"li"},"request.ip")," etc"),(0,i.kt)("li",{parentName:"ul"},"Using array notation ",(0,i.kt)("inlineCode",{parentName:"li"},"request.body[0]"))),(0,i.kt)("p",null,"There are several built in binding decorator provided "),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Decorator"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"@bind.ctx()")),(0,i.kt)("td",{parentName:"tr",align:null},"Bind request context into parameter")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"@bind.request()")),(0,i.kt)("td",{parentName:"tr",align:null},"Bind request into parameter")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"@bind.body()")),(0,i.kt)("td",{parentName:"tr",align:null},"Bind request body into parameter")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"@bind.query()")),(0,i.kt)("td",{parentName:"tr",align:null},"Bind request query into parameter")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"@bind.header()")),(0,i.kt)("td",{parentName:"tr",align:null},"Bind request header into parameter")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"@bind.user()")),(0,i.kt)("td",{parentName:"tr",align:null},"Bind JWT claim (current user) into parameter")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"@bind.file()")),(0,i.kt)("td",{parentName:"tr",align:null},"Bind file into parameter. ",(0,i.kt)("a",{parentName:"td",href:"/file-upload#Bind-File-Parser"},"See here")," on detail how to use file binding")))),(0,i.kt)("h4",{id:"name-binding"},"Name Binding"),(0,i.kt)("p",null,"Name binding is when action parameter automatically assigned with query parameter or part of body request based on its name. For example: "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"GET /animal/get?type=canine&page=1\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"class AnimalController {\n    @route.get()\n    get(type:string, page:number){}\n}\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"type")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"page")," parameter above automatically assigned with ",(0,i.kt)("inlineCode",{parentName:"p"},"canine")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"1"),". "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'POST /auth/login\nbody:\n{\n    username: "admin",\n    password: "super secret pwd"\n}\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"class AuthController {\n    @route.post()\n    login(username:string, password:string){}\n}\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"username")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"password")," will automatically assigned with part of request body ",(0,i.kt)("inlineCode",{parentName:"p"},"admin")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"super secret pwd"),"."),(0,i.kt)("p",null,"More complex example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'POST /animal/save?type=canine\nbody: \n{ \n    name: "Mimi", \n    birthDate: "2018-1-1", \n    owner: { firstName: "John", lastName: "Doe" }\n}\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"@domain()\nclass Human {\n    constructor(\n        firstName:string,\n        lastName:string\n    ){}\n}\n\nclass AnimalController {\n    @route.post()\n    save(type:string, name:string, birthDate:Date, owner:Human){}\n}\n")),(0,i.kt)("p",null,"Example above showing that ",(0,i.kt)("inlineCode",{parentName:"p"},"type")," parameter assigned with the query string ",(0,i.kt)("inlineCode",{parentName:"p"},"canine")," and the request body spread into 3 parameters ",(0,i.kt)("inlineCode",{parentName:"p"},"name"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"birthDate")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"owner"),"."),(0,i.kt)("h4",{id:"model-binding"},"Model Binding"),(0,i.kt)("p",null,"Model binding is the default behavior of parameter binding. Plumier by default will assigned request body to any parameter that has custom class type and doesn't match any binding criteria (Name Binding/Decorator binding)."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"@domain()\nclass Animal{\n    constructor(\n        public name:string,\n        public birthDate:Date,\n        public owner:Human\n    )\n}\n\nclass AnimalController {\n    @route.post()\n    save(type:string, animal:Animal){}\n}\n")),(0,i.kt)("p",null,"Request"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'POST /animal/save?type=canine\nbody: \n{ \n    name: "Mimi", \n    birthDate: "2018-1-1", \n    owner: { firstName: "John", lastName: "Doe" }\n}\n')),(0,i.kt)("p",null,"Above code, the ",(0,i.kt)("inlineCode",{parentName:"p"},"animal")," parameter in ",(0,i.kt)("inlineCode",{parentName:"p"},"save")," action will automatically bound with request body."),(0,i.kt)("h4",{id:"file-binding"},"File Binding"),(0,i.kt)("p",null,"Unlike File binding, File binding works like name binding and retrieve file(s) that already parsed into the parameter. Parameter type should be of type ",(0,i.kt)("inlineCode",{parentName:"p"},"FormFile"),". "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"interface FormFile {\n    size:number\n    path:string\n    name:string\n    type:string\n    mtime?:string\n}\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"size"),": Size of the file (bytes)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"path"),": Temporary path of the uploaded file"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"name"),": File name provided by client"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"type"),": Mime type of the file "),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"mtime"),": The file timestamp")),(0,i.kt)("p",null,"By default this feature is not enable, you need to enable this feature like below: "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"new Plumier()\n    .set(new WebApiFacility({ bodyParser: { multipart: true } }))\n")),(0,i.kt)("p",null,"Than on the controller simply do something like below"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"class PictureController {\n    @route.post()\n    save(image: FormFile) {\n        \n    }\n}\n")),(0,i.kt)("p",null,"Above code will handle multipart form below"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<form method="post" enctype="multipart/form-data" action="/picture/save">\n    <input type="file" name="image"/>\n    <input type="submit" value="Upload"/>\n</form>\n')),(0,i.kt)("p",null,"For multiple file upload, method's parameter can be specified using array like below"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import { type } from "@plumier/reflect"\n\nclass PictureController {\n    @route.post()\n    save(@type(FormFile) image: FormFile[]) {\n        \n    }\n}\n')),(0,i.kt)("h4",{id:"binding-behavior"},"Binding Behavior"),(0,i.kt)("p",null,"In order to properly bound the request, plumier use priority based on parameter binding kind above."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Decorator binding is be the first priority"),(0,i.kt)("li",{parentName:"ul"},"Name binding is the second priority"),(0,i.kt)("li",{parentName:"ul"},"Model binding is the last")),(0,i.kt)("p",null,"Its mean when an action parameter decorated with ",(0,i.kt)("inlineCode",{parentName:"p"},"@bind")," decorator it will not further check for name binding nor model binding. If an action parameter doesn't decorated with ",(0,i.kt)("inlineCode",{parentName:"p"},"@bind")," but its name match with a query parameter, it will not further check for model binding and so on."),(0,i.kt)("h2",{id:"type-converter"},"Type Converter"),(0,i.kt)("p",null,"Plumier automatically convert values provided by parameter binding match with parameter data type. If provided value doesn't match provided data type type http 422 error will be thrown. "),(0,i.kt)("h4",{id:"number-converter"},"Number Converter"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"export class AnimalController {\n    @route.get()\n    get(id:number){}\n}\n")),(0,i.kt)("p",null,"id parameter will automatically convert to ",(0,i.kt)("inlineCode",{parentName:"p"},"number")," inside ",(0,i.kt)("inlineCode",{parentName:"p"},"get")," action"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"GET /animal/get?id=123    -> 123\nGET /animal/get?id=123.33 -> 123.33\nGET /animal/get?id=hello  -> Error status 400 \n")),(0,i.kt)("h4",{id:"boolean-converter"},"Boolean Converter"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"export class AnimalController {\n    @route.get()\n    get(id:boolean){}\n}\n")),(0,i.kt)("p",null,"id parameter will automatically convert to ",(0,i.kt)("inlineCode",{parentName:"p"},"boolean")," inside ",(0,i.kt)("inlineCode",{parentName:"p"},"get")," action"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"GET /animal/get?id=ON    -> true\nGET /animal/get?id=on    -> true\nGET /animal/get?id=On    -> true\nGET /animal/get?id=TRUE  -> true\nGET /animal/get?id=True  -> true\nGET /animal/get?id=true  -> true\nGET /animal/get?id=Hello -> Error status 400 \n// working values (case insensitive): \n// ON, OFF, YES, NO, TRUE, FALSE, 1, 0\n")),(0,i.kt)("h4",{id:"date-converter"},"Date Converter"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"export class AnimalController {\n    @route.get()\n    get(id:Date){}\n}\n")),(0,i.kt)("p",null,"id parameter will automatically convert to ",(0,i.kt)("inlineCode",{parentName:"p"},"Date")," inside ",(0,i.kt)("inlineCode",{parentName:"p"},"get")," action"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"GET /animal/get?id=2018-2-1    -> equals to new Date(2018, 2, 1)\nGET /animal/get?id=hello       -> Error status 400\n")),(0,i.kt)("h4",{id:"object-converter"},"Object Converter"),(0,i.kt)("p",null,"Object converter only works for POST and PUT method"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"@domain() \nclass Animal {\n    constructor(\n        public id:number,\n        public name:string,\n        public deceased:boolean,\n        public birthday:Date\n    ){}\n}\n\nexport class AnimalController {\n    @route.post()\n    save(model:Animal){}\n}\n")),(0,i.kt)("p",null,"model parameter will automatically convert to ",(0,i.kt)("inlineCode",{parentName:"p"},"Animal")," inside ",(0,i.kt)("inlineCode",{parentName:"p"},"save")," action"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'POST /animal/save\nJSON Payload: { id: "200", name: "Mimi", deceased: "ON", birthday: "2018-1-1" }\nResult: \nAnimalController {\n    id: 200,\n    name: "Mimi",\n    deceased: true,\n    birthday: Date //equals to new Date(2018,1,1)\n}\n')),(0,i.kt)("p",null,"Object converter also supported deep nested object conversion"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"@domain()\nclass Client {\n    constructor(\n        public id: number,\n        public name: string,\n        public join: Date\n    ) { }\n}\n@domain()\nclass Animal {\n    constructor(\n        public id: number,\n        public name: string,\n        public deceased: boolean,\n        public birthday: Date,\n        public owner: Client\n    ) { }\n}\n\nexport class AnimalController {\n    @route.post()\n    save(model:Animal){}\n}\n")),(0,i.kt)("p",null,"model parameter will automatically convert to ",(0,i.kt)("inlineCode",{parentName:"p"},"Animal")," inside ",(0,i.kt)("inlineCode",{parentName:"p"},"save")," action"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'POST /animal/save\nJSON Payload: {\n    id: "200",\n    name: "Mimi",\n    deceased: "ON",\n    birthday: "2018-1-1",\n    owner: {\n        id: "400",\n        name: "John Doe",\n        join: "2015-1-1"\n    }\n}\n\nResult: \nAnimal {\n    birthday: new Date("2018-1-1"), \n    deceased: true, \n    id: 200, \n    name: "Mimi",\n    owner: Client {\n        id: 400,\n        name: "John Doe",\n        join: new Date("2015-1-1")\n    }\n}\n')),(0,i.kt)("h4",{id:"array-converter"},"Array Converter"),(0,i.kt)("p",null,"Array converter a little bit different due to TypeScript ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Microsoft/TypeScript/issues/12463"},"design type emit limitation"),", use ",(0,i.kt)("inlineCode",{parentName:"p"},"@plumier/reflect")," ",(0,i.kt)("inlineCode",{parentName:"p"},"@type()")," decorator to specify array element data type."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import { type } from "@plumier/reflect"\n\n@domain() \nclass AnimalDto {\n    constructor(\n        public id:number\n        public name:string\n        public deceased:boolean\n        public birthday:Date\n    ){}\n}\n\nexport class AnimalController {\n    @route.post()\n    save(@type([AnimalDto]) model:AnimalDto[]){}\n}\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'POST /animal/save\nJSON Payload: [{ id: "200", name: "Mimi", deceased: "ON", birthday: "2018-1-1" }]\nResult: \n[{\n    id: 200,\n    name: "Mimi",\n    deceased: true,\n    birthday: Date //equals to new Date(2018,1,1)\n}]\n')),(0,i.kt)("h2",{id:"controller-return-value"},"Controller Return Value"),(0,i.kt)("p",null,"Controller can return any JavaScript value including promised value and rendered into JSON response. Promised value automatically awaited during JSON serialization. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'class AnimalController {\n    @route.get(":id")\n    get(id:string){\n        // return promise directly from repository\n        return animalRepo.findById(id)\n    }\n}\n')),(0,i.kt)("h4",{id:"return-value-data-type"},"Return Value Data Type"),(0,i.kt)("p",null,"To get the proper result (for swagger and response authorization) its required to specify data type of the action return value by using ",(0,i.kt)("inlineCode",{parentName:"p"},"@type")," decorator. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript",metastring:"{5,11}","{5,11}":!0},'import { type } from "@plumier/reflect"\n\nclass AnimalController {\n    @route.get(":id")\n    @type(x => Animal) // specify data type \n    get(id:string){\n        return animalRepo.findById(id)\n    }\n\n    @route.get("")\n    @type(x => [Animal]) // specify data type (array of Animal)\n    list() {\n        return animalRepo.find()\n    }\n}\n')),(0,i.kt)("h2",{id:"action-result"},"Action Result"),(0,i.kt)("p",null,"For more advance result that require setting http status or response header can be done using ",(0,i.kt)("inlineCode",{parentName:"p"},"ActionResult"),"."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"ActionResult")," is a special class that used to create an Http Response. ",(0,i.kt)("inlineCode",{parentName:"p"},"ActionResult")," has ability to modify Http Response which make it possible to make a custom response such as return an html, file, file download etc. "),(0,i.kt)("h4",{id:"action-result-signature"},"Action Result Signature"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"ActionResult")," signature has some similarities with the http response like below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"class ActionResult {\n    static fromContext(ctx: Context) : ActionResult\n    constructor(public body?: any, public status?: number)\n    setHeader(key: string, value: string) : ActionResult\n    setStatus(status: number): ActionResult\n    execute(ctx: Context): Promise<void> \n}\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"fromContext")," create ",(0,i.kt)("inlineCode",{parentName:"li"},"ActionResult")," from Koa context"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"setHeader")," set header that will be used by Http Response"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"setStatus")," set Http Status that will be use by Http Response"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"execute")," internally called by Plumier to generate Koa context and render the response")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"setHeader")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"setStatus")," designed to be chainable, so it will be able to create ",(0,i.kt)("inlineCode",{parentName:"p"},"ActionResult")," object like below"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'return new ActionResult({ message: "The body" })\n    .setStatus(400)\n    .setHeader("key", "value")\n')),(0,i.kt)("h4",{id:"action-result-implementation"},"Action Result Implementation"),(0,i.kt)("p",null,"Currently now Plumier has three types of ",(0,i.kt)("inlineCode",{parentName:"p"},"ActionResult")," implementation: "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ActionResult")," by default will returned JSON response"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"RedirectActionResult")," used to redirect request to specific url, internally it calls Koa ",(0,i.kt)("inlineCode",{parentName:"li"},"Context.redirect")," "),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"FileActionResult")," returned a file response based on provided file path. This class only enable when ",(0,i.kt)("inlineCode",{parentName:"li"},"@plumier/serve-static")," installed.")),(0,i.kt)("p",null,"A shorthand namespace available to access all of above implementation called ",(0,i.kt)("inlineCode",{parentName:"p"},"response")," "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import {route, response} from "plumier"\n\nclass AnimalController {\n    @route.get()\n    index(){\n        return response.redirect(<url>)\n    }\n}\n')),(0,i.kt)("h4",{id:"custom-action-result"},"Custom Action Result"),(0,i.kt)("p",null,"It is possible to extends the ability of ",(0,i.kt)("inlineCode",{parentName:"p"},"ActionResult")," to modify the Http response to return custom http response. The main logic is on the ",(0,i.kt)("inlineCode",{parentName:"p"},"execute")," method."),(0,i.kt)("p",null,"For example the implementation of ",(0,i.kt)("inlineCode",{parentName:"p"},"FileActionResult")," is quite simple as below"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import send from "koa-send"\nimport { extname } from "path"\n\nexport class FileActionResult extends ActionResult {\n    constructor(path: string) {\n        super(path)\n    }\n\n    async execute(ctx: Context) {\n        await super.execute(ctx)\n        ctx.type = extname(this.body)\n        await send(ctx, this.body)\n    }\n}\n')),(0,i.kt)("h2",{id:"throwing-errors"},"Throwing Errors"),(0,i.kt)("p",null,"Any uncaught error will automatically handled by Plumier and translated into http response with status 500. You can throw ",(0,i.kt)("inlineCode",{parentName:"p"},"HttpStatusError")," to provide custom error message with some http status that will be rendered into proper JSON response with appropriate status."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import {route, response} from "plumier"\n\nclass AnimalController {\n    @route.get()\n    index(){\n        // other code \n        throw new HttpStatusError(400, "Please provide a good request")\n    }\n}\n')))}m.isMDXComponent=!0}}]);