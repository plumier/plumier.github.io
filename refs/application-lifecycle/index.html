<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.ff31de0ff">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Plumier Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Plumier Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Plumier" href="/opensearch.xml"><title data-react-helmet="true">Application Lifecycle | Plumier</title><meta data-react-helmet="true" property="og:url" content="https://plumierjs.com/refs/application-lifecycle"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Application Lifecycle | Plumier"><meta data-react-helmet="true" name="description" content="When an Http Request issued into Plumier application, the process goes through a series of processing steps that can be categorized into three main process. Infographic picture below showing the various stage of Plumier Application Life Cycle."><meta data-react-helmet="true" property="og:description" content="When an Http Request issued into Plumier application, the process goes through a series of processing steps that can be categorized into three main process. Infographic picture below showing the various stage of Plumier Application Life Cycle."><link data-react-helmet="true" rel="shortcut icon" href="/img/plumier.png"><link data-react-helmet="true" rel="canonical" href="https://plumierjs.com/refs/application-lifecycle"><link data-react-helmet="true" rel="alternate" href="https://plumierjs.com/refs/application-lifecycle" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://plumierjs.com/refs/application-lifecycle" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.42ac0ac4.css">
<link rel="preload" href="/assets/js/runtime~main.c70da86b.js" as="script">
<link rel="preload" href="/assets/js/main.6f5fb365.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_2vEk">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_rQcN"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/plumier.png" alt="Plumier logo" class="themedImage_2dpp themedImage--light_2yWi navbar__logo"><img src="/img/plumier.png" alt="Plumier logo" class="themedImage_2dpp themedImage--dark_2O_X navbar__logo"><strong class="navbar__title">Plumier</strong></a><a class="navbar__item navbar__link" href="/plumier-in-five-minutes">Docs</a><a href="https://github.com/plumier/examples" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Examples</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/plumier/plumier" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_2YK8 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_2wcW">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_2wcW">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/plumier.png" alt="Plumier logo" class="themedImage_2dpp themedImage--light_2yWi navbar__logo"><img src="/img/plumier.png" alt="Plumier logo" class="themedImage_2dpp themedImage--dark_2O_X navbar__logo"><strong class="navbar__title">Plumier</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/plumier-in-five-minutes">Docs</a></li><li class="menu__list-item"><a href="https://github.com/plumier/examples" target="_blank" rel="noopener noreferrer" class="menu__link">Examples</a></li><li class="menu__list-item"><a href="https://github.com/plumier/plumier" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_2hm3"><main class="docMainContainer_luF8 docMainContainerEnhanced_1KzL"><div class="container padding-vert--lg docItemWrapper_12Bq"><div class="row"><div class="col docItemCol_1cpl"><div class="docItemContainer_1YW1"><article><header><h1 class="docTitle_eZEF">Application Lifecycle</h1></header><div class="markdown"><p>When an Http Request issued into Plumier application, the process goes through a series of processing steps that can be categorized into three main process. Infographic picture below showing the various stage of Plumier Application Life Cycle.</p><p><img alt="Application Life Cycle" src="/assets/images/application-lifecycle-2bfeacf5788605df57e819bb6b1d4aff.png"></p><p>Above picture showing the Plumier components, the lifecycle sequence start from left to right then return back to left after execution done.</p><p><img alt="Sequence Diagram" src="/assets/images/request-sequence-3874fcc4d39b1ca6d905415a1b7197ea.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="router"></a>Router<a class="hash-link" href="#router" title="Direct link to heading">#</a></h2><p>Router is the main process during the occurrence of the http request. There three main process inside router are: </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="routing"></a>Routing<a class="hash-link" href="#routing" title="Direct link to heading">#</a></h3><p>Routing will parse the request URL into path and query object using RegEx and specify the correct controller that will handle the request. </p><p>There are <code>Context</code> variable (<code>ctx</code>) initialized during this phase. <code>ctx</code> accessible from middleware using <code>invocation.ctx</code></p><ol><li><code>ctx.route</code> contains route metadata information such as controller name, current method name, parameters, route etc. The value can be <code>undefined</code> if the current request doesn&#x27;t associated with any controller.</li><li><code>ctx.request.query</code> contains request query string in query form. </li><li><code>ctx.config</code> contains Plumier application configuration.</li><li><code>ctx.routes</code> contains all routes metadata information, this values got during route generation process on initialization process.</li></ol><p>All above context property only accessible within process after the routing. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="result-execution"></a>Result Execution<a class="hash-link" href="#result-execution" title="Direct link to heading">#</a></h3><p>Router executes middleware pipeline and wait for the returned <code>ActionResult</code>. Action result contains raw values will be used to render the Http Response such as request body, headers, cookies etc. </p><p>Result execution process executes the <code>ActionResult</code> by calling its <code>execute</code> method and render the Http Response.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="error-handler"></a>Error Handler<a class="hash-link" href="#error-handler" title="Direct link to heading">#</a></h3><p>Router surrounded with a global try-catch to catch all thrown error inside the next phases (Middleware Pipeline and Action Invoker). </p><p>All uncaught error usually translated into Http Response with status 500 except using <code>HttpStatusError</code> or <code>ValidationError</code> will result different http status.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="middleware-pipeline"></a>Middleware Pipeline<a class="hash-link" href="#middleware-pipeline" title="Direct link to heading">#</a></h2><p>Middleware pipeline executes middlewares using stack-like sequence. Basically its works like Koa middleware pipeline. The first middleware has full control of the next invocation (can be another middleware execution or a controller execution). </p><p>It can execute next invocation using some condition such as check for login user or check some query string before proceeding. Further more middleware can modify execution result that will be used to create http response, such as modify the response body, response status etc.</p><p>Middleware executed inside middleware pipeline has a sequence like below: </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="global-middlewares"></a>Global Middlewares<a class="hash-link" href="#global-middlewares" title="Direct link to heading">#</a></h3><p>All global middlewares: middleware that registered using application <code>use</code> method or registered using <code>Facility</code> will be executed first. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="parameter-binding-middleware"></a>Parameter Binding Middleware<a class="hash-link" href="#parameter-binding-middleware" title="Direct link to heading">#</a></h3><p>Parameter binding middleware will translate request values (body, header, cookie, query string etc) into parameter values. Parameter binding mutate the <code>ctx</code> property used to save the result. <code>ctx.parameters</code> will store the raw (not converted nor validated) value of the parameter binding. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="converter--validation-middleware"></a>Converter &amp; Validation middleware<a class="hash-link" href="#converter--validation-middleware" title="Direct link to heading">#</a></h3><p>Converter and Validation middleware will convert the <code>ctx.parameters</code> raw value created by parameter binding into appropriate datatype match with controller&#x27;s method parameter type. The conversion result replaces the <code>ctx.parameters</code> created by parameter binding with those cleansed values.</p><p>Converter and Validation will throw <code>ValidationError</code> and rendered into Http Response with 422 status code.</p><p>During creation of custom converter, Plumier uses dependency resolver to create instance of the custom converter. This behavior can be extended using custom dependency resolver with dependency injection framework of the choice.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="authorization-middleware"></a>Authorization Middleware<a class="hash-link" href="#authorization-middleware" title="Direct link to heading">#</a></h3><p>Authorization Middleware will restrict access to a controller&#x27;s method, its disabled by default. Authorization can be activated by setting the <code>enableAuthorization</code> on Plumier configuration, or by installing <code>JwtAuthFacility</code>. </p><p>Authorization will throw <code>HttpStatusError</code> with status code 403 Forbidden and 401 unauthorized</p><p>Plumier also uses dependency resolver to create instance of custom authorization for dependency injection.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="controller--method-middleware"></a>Controller / Method Middleware<a class="hash-link" href="#controller--method-middleware" title="Direct link to heading">#</a></h3><p>Controller / Method middleware is middleware registered using <code>@middleware.use()</code> decorator above the controller or method declaration. Controller / Method middleware can use the <code>ActionContext</code> and has access to <code>ctx.parameters</code> with a cleansed value.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="action-invoker"></a>Action Invoker<a class="hash-link" href="#action-invoker" title="Direct link to heading">#</a></h2><p>Action invoker execute the controller&#x27;s method handle the request. Action invoker is an optional phase, but most important and complex phase. </p><p>Inside Action Invoker, request context <code>Context</code> class mutated with a new <code>parameters</code> property. There is a derived class of <code>Context</code> can be used for convenient named <code>ActionContext</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="controller-creation"></a>Controller Creation<a class="hash-link" href="#controller-creation" title="Direct link to heading">#</a></h3><p>Controller creation is an important phase because it uses dependency resolver to create instance of the controller. This phase always happened on every request that has controller handler.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="method-invocation"></a>Method Invocation<a class="hash-link" href="#method-invocation" title="Direct link to heading">#</a></h3><p>Method invocation will invoke the appropriate method handles the request using the <code>ctx.parameters</code> values. This method invocation process returned promised <code>ActionResult</code> even if the method returned a non <code>ActionResult</code> value.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/plumier/plumier/edit/master/docs/docusaurus/docs/refs/Application-Lifecycle.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2nOl" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2Tf- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#router" class="table-of-contents__link">Router</a><ul><li><a href="#routing" class="table-of-contents__link">Routing</a></li><li><a href="#result-execution" class="table-of-contents__link">Result Execution</a></li><li><a href="#error-handler" class="table-of-contents__link">Error Handler</a></li></ul></li><li><a href="#middleware-pipeline" class="table-of-contents__link">Middleware Pipeline</a><ul><li><a href="#global-middlewares" class="table-of-contents__link">Global Middlewares</a></li><li><a href="#parameter-binding-middleware" class="table-of-contents__link">Parameter Binding Middleware</a></li><li><a href="#converter--validation-middleware" class="table-of-contents__link">Converter &amp; Validation middleware</a></li><li><a href="#authorization-middleware" class="table-of-contents__link">Authorization Middleware</a></li><li><a href="#controller--method-middleware" class="table-of-contents__link">Controller / Method Middleware</a></li></ul></li><li><a href="#action-invoker" class="table-of-contents__link">Action Invoker</a><ul><li><a href="#controller-creation" class="table-of-contents__link">Controller Creation</a></li><li><a href="#method-invocation" class="table-of-contents__link">Method Invocation</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/plumier-in-five-minutes">Fundamentals</a></li><li class="footer__item"><a class="footer__link-item" href="/quick-start">Plumier in Five Minutes</a></li><li class="footer__item"><a class="footer__link-item" href="/extend">Extending Plumier</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/plumier" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/plumier/plumier" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Plumier.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c70da86b.js"></script>
<script src="/assets/js/main.6f5fb365.js"></script>
</body>
</html>